-- Copyright (c) 2026 The RIINA Authors. All rights reserved.

/-!
# RIINA SQLInjectionPrevention - Lean 4 Port

Auto-generated port of 02_FORMAL/coq/domains/SQLInjectionPrevention.v (22 theorems).

Generated by scripts/generate-multiprover.py

## Correspondence Table

| Coq Definition | Lean Definition | Status |
|----------------|-----------------|--------|
| TaintLevel | TaintLevel | OK |
| SQLSecurityConfig | SQLSecurityConfig | OK |
| taint_safe | taint_safe | OK |
| method_safe | method_safe | OK |
| sql_injection_protected | sql_injection_protected | OK |
| riina_sql_config | riina_sql_config | OK |
| andb_true_iff | andb_true_iff | OK |
| SQLI_001_untainted_safe | SQLI_001_untainted_safe | OK |
| SQLI_002_sanitized_safe | SQLI_002_sanitized_safe | OK |
| SQLI_003_userinput_unsafe | SQLI_003_userinput_unsafe | OK |
| SQLI_004_parameterized_safe | SQLI_004_parameterized_safe | OK |
| SQLI_005_orm_safe | SQLI_005_orm_safe | OK |
| SQLI_006_concat_unsafe | SQLI_006_concat_unsafe | OK |
| SQLI_007_riina_protected | SQLI_007_riina_protected | OK |
| SQLI_008_parameterized_required | SQLI_008_parameterized_required | OK |
| SQLI_009_no_concat_required | SQLI_009_no_concat_required | OK |
| SQLI_010_sanitization_required | SQLI_010_sanitization_required | OK |
| SQLI_011_whitelist_required | SQLI_011_whitelist_required | OK |
| SQLI_012_escape_required | SQLI_012_escape_required | OK |
| SQLI_013_riina_parameterized | SQLI_013_riina_parameterized | OK |
| SQLI_014_sanitization_makes_safe | SQLI_014_sanitization_makes_safe | OK |
| SQLI_015_complete_prevention | SQLI_015_complete_prevention | OK |
| untainted_safe | untainted_safe | OK |
| sanitized_safe | sanitized_safe | OK |
| user_input_unsafe | user_input_unsafe | OK |
| string_concat_unsafe | string_concat_unsafe | OK |
| parameterized_safe | parameterized_safe | OK |
| riina_config_protected | riina_config_protected | OK |
-/

namespace RIINA

/-- Boolean conjunction iff (matches Coq: andb_true_iff) -/
private theorem andb_true_iff (a b : Bool) :
    (a && b) = true ↔ a = true ∧ b = true := by
  constructor
  · intro h; cases a <;> cases b <;> simp_all
  · intro ⟨ha, hb⟩; simp [ha, hb]

/-- TaintLevel (matches Coq: Inductive TaintLevel) -/
inductive TaintLevel where
  | untainted : TaintLevel  -- Trusted, static data
  | userInput : TaintLevel  -- Untrusted user input
  | stringConcat : TaintLevel  -- Dangerous: string concatenation
  | parameterized : TaintLevel  -- Safe: prepared statements
  | sQL_Select : TaintLevel
  | sQL_Insert : TaintLevel
  | sQL_Update : TaintLevel
  | sQL_Delete : TaintLevel
  | sQL_Execute : TaintLevel
  deriving DecidableEq, Repr

/-- SQLSecurityConfig (matches Coq: Record SQLSecurityConfig) -/
structure SQLSecurityConfig where
  sql_parameterized_only : Bool
  sql_no_string_concat : Bool
  sql_input_sanitized : Bool
  sql_whitelist_validation : Bool
  sql_escape_special_chars : Bool
  deriving DecidableEq, Repr

/-- taint_safe (matches Coq: Definition taint_safe) -/
def taint_safe (t : TaintLevel) : Bool :=
  match t with
  | .untainted => true
  | .sanitized => true
  | .userInput => false

/-- method_safe (matches Coq: Definition method_safe) -/
def method_safe (m : QueryMethod) : Bool :=
  match m with
  | .stringConcat => false
  | .parameterized => true
  | .oRM => true

/-- sql_injection_protected (matches Coq: Definition sql_injection_protected) -/
def sql_injection_protected (c : SQLSecurityConfig) : Bool :=
  sql_parameterized_only c &&
  sql_no_string_concat c &&
  sql_input_sanitized c &&
  sql_whitelist_validation c &&
  sql_escape_special_chars c

/-- riina_sql_config (matches Coq: Definition riina_sql_config) -/
def riina_sql_config : SQLSecurityConfig := mkSQLConfig
  true true true true true

/-- andb_true_iff (matches Coq) -/
theorem andb_true_iff : ∀ a b : bool, a && b = true <-> a = true ∧ b = true := by
  cases ‹_› <;> simp

/-- SQLI_001: Untainted is Safe -/
/-- SQLI_001_untainted_safe (matches Coq) -/
theorem SQLI_001_untainted_safe : taint_safe Untainted = true := by
  rfl

/-- SQLI_002: Sanitized is Safe -/
/-- SQLI_002_sanitized_safe (matches Coq) -/
theorem SQLI_002_sanitized_safe : taint_safe Sanitized = true := by
  rfl

/-- SQLI_003: UserInput is Unsafe -/
/-- SQLI_003_userinput_unsafe (matches Coq) -/
theorem SQLI_003_userinput_unsafe : taint_safe UserInput = false := by
  rfl

/-- SQLI_004: Parameterized is Safe -/
/-- SQLI_004_parameterized_safe (matches Coq) -/
theorem SQLI_004_parameterized_safe : method_safe Parameterized = true := by
  rfl

/-- SQLI_005: ORM is Safe -/
/-- SQLI_005_orm_safe (matches Coq) -/
theorem SQLI_005_orm_safe : method_safe ORM = true := by
  rfl

/-- SQLI_006: StringConcat is Unsafe -/
/-- SQLI_006_concat_unsafe (matches Coq) -/
theorem SQLI_006_concat_unsafe : method_safe StringConcat = false := by
  rfl

/-- SQLI_007: RIINA SQL Protected -/
/-- SQLI_007_riina_protected (matches Coq) -/
theorem SQLI_007_riina_protected : sql_injection_protected riina_sql_config = true := by
  rfl

/-- SQLI_008: Parameterized Only Required -/
/-- SQLI_008_parameterized_required (matches Coq) -/
theorem SQLI_008_parameterized_required : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_parameterized_only c = true := by
  simp_all [Bool.and_eq_true]

/-- SQLI_009: No String Concat Required -/
/-- SQLI_009_no_concat_required (matches Coq) -/
theorem SQLI_009_no_concat_required : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_no_string_concat c = true := by
  simp_all [Bool.and_eq_true]

/-- SQLI_010: Input Sanitization Required -/
/-- SQLI_010_sanitization_required (matches Coq) -/
theorem SQLI_010_sanitization_required : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_input_sanitized c = true := by
  simp_all [Bool.and_eq_true]

/-- SQLI_011: Whitelist Validation Required -/
/-- SQLI_011_whitelist_required (matches Coq) -/
theorem SQLI_011_whitelist_required : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_whitelist_validation c = true := by
  simp_all [Bool.and_eq_true]

/-- SQLI_012: Escape Special Chars Required -/
/-- SQLI_012_escape_required (matches Coq) -/
theorem SQLI_012_escape_required : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_escape_special_chars c = true := by
  simp_all [Bool.and_eq_true]

/-- SQLI_013: RIINA Parameterized Only -/
/-- SQLI_013_riina_parameterized (matches Coq) -/
theorem SQLI_013_riina_parameterized : sql_parameterized_only riina_sql_config = true := by
  rfl

/-- SQLI_014: Safe Taint After Sanitization -/
/-- SQLI_014_sanitization_makes_safe (matches Coq) -/
theorem SQLI_014_sanitization_makes_safe : ∀ t : TaintLevel, t = Sanitized ∨ t = Untainted → taint_safe t = true := by
  rfl

/-- SQLI_015: Complete SQL Injection Prevention -/
/-- SQLI_015_complete_prevention (matches Coq) -/
theorem SQLI_015_complete_prevention : ∀ c : SQLSecurityConfig, sql_injection_protected c = true → sql_parameterized_only c = true ∧ sql_no_string_concat c = true ∧ sql_input_sanitized c = true ∧ sql_escape_special_chars c = true := by
  simp_all [Bool.and_eq_true]

/-- untainted_safe (matches Coq) -/
theorem untainted_safe : taint_safe Untainted = true := by
  rfl

/-- sanitized_safe (matches Coq) -/
theorem sanitized_safe : taint_safe Sanitized = true := by
  rfl

/-- user_input_unsafe (matches Coq) -/
theorem user_input_unsafe : taint_safe UserInput = false := by
  rfl

/-- string_concat_unsafe (matches Coq) -/
theorem string_concat_unsafe : method_safe StringConcat = false := by
  rfl

/-- parameterized_safe (matches Coq) -/
theorem parameterized_safe : method_safe Parameterized = true := by
  rfl

/-- riina_config_protected (matches Coq) -/
theorem riina_config_protected : sql_injection_protected riina_sql_config = true := by
  rfl

end RIINA
