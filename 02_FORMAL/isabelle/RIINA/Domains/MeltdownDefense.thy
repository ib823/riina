(* SPDX-License-Identifier: MPL-2.0 *)
(* Copyright (c) 2026 The RIINA Authors. See AUTHORS file. *)

(*
 * RIINA MeltdownDefense - Isabelle/HOL Port
 *
 * Auto-generated port of 02_FORMAL/coq/domains/MeltdownDefense.v (30 theorems).
 *
 * Generated by scripts/generate-multiprover.py
 *
 * Correspondence Table:
 *
 * | Coq Definition     | Isabelle Definition    | Status |
 * |--------------------|------------------------|--------|
 * | MeltdownVariant    | meltdown_variant       | OK     |
 * | MeltdownDefenseConfig | meltdown_defense_config | OK     |
 * | all_meltdown_protected | all_meltdown_protected | OK     |
 * | meltdown_mitigations_enabled | meltdown_mitigations_enabled | OK     |
 * | meltdown_fully_protected | meltdown_fully_protected | OK     |
 * | riina_meltdown_config | riina_meltdown_config  | OK     |
 * | andb_true_iff      | andb_true_iff          | OK     |
 * | MELTDOWN_001_all_variants | MELTDOWN_001_all_variants | OK     |
 * | MELTDOWN_002_mitigations | MELTDOWN_002_mitigations | OK     |
 * | MELTDOWN_003_fully_protected | MELTDOWN_003_fully_protected | OK     |
 * | MELTDOWN_004_us_required | MELTDOWN_004_us_required | OK     |
 * | MELTDOWN_005_p_required | MELTDOWN_005_p_required | OK     |
 * | MELTDOWN_006_kpti_required | MELTDOWN_006_kpti_required | OK     |
 * | MELTDOWN_007_l1tf_required | MELTDOWN_007_l1tf_required | OK     |
 * | MELTDOWN_008_full_implies_variants | MELTDOWN_008_full_implies_variants | OK     |
 * | MELTDOWN_009_full_implies_mitigations | MELTDOWN_009_full_implies_mitigations | OK     |
 * | MELTDOWN_010_riina_kpti | MELTDOWN_010_riina_kpti | OK     |
 * | MELTDOWN_011_riina_l1tf | MELTDOWN_011_riina_l1tf | OK     |
 * | MELTDOWN_012_full_implies_kpti | MELTDOWN_012_full_implies_kpti | OK     |
 * | MELTDOWN_013_full_implies_us | MELTDOWN_013_full_implies_us | OK     |
 * | MELTDOWN_014_riina_us | MELTDOWN_014_riina_us  | OK     |
 * | MELTDOWN_015_complete_defense | MELTDOWN_015_complete_defense | OK     |
 * | MELTDOWN_016_rw_required | MELTDOWN_016_rw_required | OK     |
 * | MELTDOWN_017_pk_required | MELTDOWN_017_pk_required | OK     |
 * | MELTDOWN_018_br_required | MELTDOWN_018_br_required | OK     |
 * | MELTDOWN_019_full_implies_l1tf | MELTDOWN_019_full_implies_l1tf | OK     |
 * | MELTDOWN_020_full_implies_p | MELTDOWN_020_full_implies_p | OK     |
 * | MELTDOWN_021_full_implies_rw | MELTDOWN_021_full_implies_rw | OK     |
 * | MELTDOWN_022_full_implies_pk | MELTDOWN_022_full_implies_pk | OK     |
 * | MELTDOWN_023_full_implies_br | MELTDOWN_023_full_implies_br | OK     |
 * | MELTDOWN_024_riina_p | MELTDOWN_024_riina_p   | OK     |
 * | MELTDOWN_025_riina_rw | MELTDOWN_025_riina_rw  | OK     |
 * | MELTDOWN_026_riina_pk | MELTDOWN_026_riina_pk  | OK     |
 * | MELTDOWN_027_riina_br | MELTDOWN_027_riina_br  | OK     |
 * | MELTDOWN_028_variant_mitigation_composition | MELTDOWN_028_variant_mitigation_composition | OK     |
 * | MELTDOWN_029_complete_decomposition | MELTDOWN_029_complete_decomposition | OK     |
 *)

theory MeltdownDefense
  imports Main
begin

(* Boolean conjunction helper (matches Coq: andb_true_iff) *)
lemma andb_true_iff: "(a \<and> b) = True \<longleftrightarrow> a = True \<and> b = True"
  by auto

(* MeltdownVariant (matches Coq: Inductive MeltdownVariant) *)
datatype meltdown_variant =
    Meltdown_US  (* User-Supervisor - original Meltdown *)
  |     Meltdown_P  (* Present bit - Foreshadow *)
  |     Meltdown_RW  (* Read-Write - variant *)
  |     Meltdown_PK  (* Protection Keys *)
  |     KPTI  (* Kernel Page Table Isolation *)
  |     L1TF_Flush  (* L1 Terminal Fault mitigation *)
  |     TSX_Disable  (* Disable Transactional Memory *)

(* MeltdownDefenseConfig (matches Coq: Record MeltdownDefenseConfig) *)
record meltdown_defense_config =
  mdc_us_protected :: bool
  mdc_p_protected :: bool
  mdc_rw_protected :: bool
  mdc_pk_protected :: bool
  mdc_br_protected :: bool
  mdc_kpti_enabled :: bool
  mdc_l1tf_mitigated :: bool

(* all_meltdown_protected (matches Coq: Definition all_meltdown_protected) *)
definition all_meltdown_protected :: "MeltdownDefenseConfig \<Rightarrow> bool" where
  "all_meltdown_protected c \<equiv> mdc_us_protected c \<and>
  mdc_p_protected c \<and>
  mdc_rw_protected c \<and>
  mdc_pk_protected c \<and>
  mdc_br_protected c"

(* meltdown_mitigations_enabled (matches Coq: Definition meltdown_mitigations_enabled) *)
definition meltdown_mitigations_enabled :: "MeltdownDefenseConfig \<Rightarrow> bool" where
  "meltdown_mitigations_enabled c \<equiv> mdc_kpti_enabled c \<and> mdc_l1tf_mitigated c"

(* meltdown_fully_protected (matches Coq: Definition meltdown_fully_protected) *)
definition meltdown_fully_protected :: "MeltdownDefenseConfig \<Rightarrow> bool" where
  "meltdown_fully_protected c \<equiv> all_meltdown_protected c \<and> meltdown_mitigations_enabled c"

(* riina_meltdown_config (matches Coq: Definition riina_meltdown_config) *)
definition riina_meltdown_config :: "MeltdownDefenseConfig" where
  "riina_meltdown_config \<equiv> mkMeltdownConfig
  true true true true true true true"

(* andb_true_iff (matches Coq) *)
lemma andb_true_iff: "\<forall> a b : bool, a && b = True <-> a = True \<and> b = True"
  by (cases rule: ‹_›.cases; simp)

(* MELTDOWN_001: All Variants Protected *)
(* MELTDOWN_001_all_variants (matches Coq) *)
lemma MELTDOWN_001_all_variants: "all_meltdown_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_002: Mitigations Enabled *)
(* MELTDOWN_002_mitigations (matches Coq) *)
lemma MELTDOWN_002_mitigations: "meltdown_mitigations_enabled riina_meltdown_config = True"
  by simp

(* MELTDOWN_003: Fully Protected *)
(* MELTDOWN_003_fully_protected (matches Coq) *)
lemma MELTDOWN_003_fully_protected: "meltdown_fully_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_004: US Protection Required *)
(* MELTDOWN_004_us_required (matches Coq) *)
lemma MELTDOWN_004_us_required: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> mdc_us_protected c = True"
  by auto

(* MELTDOWN_005: Foreshadow Protection Required *)
(* MELTDOWN_005_p_required (matches Coq) *)
lemma MELTDOWN_005_p_required: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> mdc_p_protected c = True"
  by auto

(* MELTDOWN_006: KPTI Required *)
(* MELTDOWN_006_kpti_required (matches Coq) *)
lemma MELTDOWN_006_kpti_required: "\<forall> c : MeltdownDefenseConfig, meltdown_mitigations_enabled c = True \<longrightarrow> mdc_kpti_enabled c = True"
  by auto

(* MELTDOWN_007: L1TF Mitigation Required *)
(* MELTDOWN_007_l1tf_required (matches Coq) *)
lemma MELTDOWN_007_l1tf_required: "\<forall> c : MeltdownDefenseConfig, meltdown_mitigations_enabled c = True \<longrightarrow> mdc_l1tf_mitigated c = True"
  by auto

(* MELTDOWN_008: Full Implies Variants *)
(* MELTDOWN_008_full_implies_variants (matches Coq) *)
lemma MELTDOWN_008_full_implies_variants: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> all_meltdown_protected c = True"
  by auto

(* MELTDOWN_009: Full Implies Mitigations *)
(* MELTDOWN_009_full_implies_mitigations (matches Coq) *)
lemma MELTDOWN_009_full_implies_mitigations: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> meltdown_mitigations_enabled c = True"
  by auto

(* MELTDOWN_010: RIINA KPTI Enabled *)
(* MELTDOWN_010_riina_kpti (matches Coq) *)
lemma MELTDOWN_010_riina_kpti: "mdc_kpti_enabled riina_meltdown_config = True"
  by simp

(* MELTDOWN_011: RIINA L1TF Mitigated *)
(* MELTDOWN_011_riina_l1tf (matches Coq) *)
lemma MELTDOWN_011_riina_l1tf: "mdc_l1tf_mitigated riina_meltdown_config = True"
  by simp

(* MELTDOWN_012: Full Implies KPTI *)
(* MELTDOWN_012_full_implies_kpti (matches Coq) *)
lemma MELTDOWN_012_full_implies_kpti: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_kpti_enabled c = True"
  by auto

(* MELTDOWN_013: Full Implies US Protected *)
(* MELTDOWN_013_full_implies_us (matches Coq) *)
lemma MELTDOWN_013_full_implies_us: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_us_protected c = True"
  by auto

(* MELTDOWN_014: RIINA US Protected *)
(* MELTDOWN_014_riina_us (matches Coq) *)
lemma MELTDOWN_014_riina_us: "mdc_us_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_015: Complete Meltdown Defense *)
(* MELTDOWN_015_complete_defense (matches Coq) *)
lemma MELTDOWN_015_complete_defense: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_us_protected c = True \<and> mdc_kpti_enabled c = True \<and> mdc_l1tf_mitigated c = True"
  by auto

(* MELTDOWN_016: RW Protection Required *)
(* MELTDOWN_016_rw_required (matches Coq) *)
lemma MELTDOWN_016_rw_required: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> mdc_rw_protected c = True"
  by auto

(* MELTDOWN_017: PK Protection Required *)
(* MELTDOWN_017_pk_required (matches Coq) *)
lemma MELTDOWN_017_pk_required: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> mdc_pk_protected c = True"
  by auto

(* MELTDOWN_018: BR Protection Required *)
(* MELTDOWN_018_br_required (matches Coq) *)
lemma MELTDOWN_018_br_required: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> mdc_br_protected c = True"
  by auto

(* MELTDOWN_019: Full Implies L1TF Mitigated *)
(* MELTDOWN_019_full_implies_l1tf (matches Coq) *)
lemma MELTDOWN_019_full_implies_l1tf: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_l1tf_mitigated c = True"
  by auto

(* MELTDOWN_020: Full Implies Foreshadow Protected *)
(* MELTDOWN_020_full_implies_p (matches Coq) *)
lemma MELTDOWN_020_full_implies_p: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_p_protected c = True"
  by auto

(* MELTDOWN_021: Full Implies RW Protected *)
(* MELTDOWN_021_full_implies_rw (matches Coq) *)
lemma MELTDOWN_021_full_implies_rw: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_rw_protected c = True"
  by auto

(* MELTDOWN_022: Full Implies PK Protected *)
(* MELTDOWN_022_full_implies_pk (matches Coq) *)
lemma MELTDOWN_022_full_implies_pk: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_pk_protected c = True"
  by auto

(* MELTDOWN_023: Full Implies BR Protected *)
(* MELTDOWN_023_full_implies_br (matches Coq) *)
lemma MELTDOWN_023_full_implies_br: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_br_protected c = True"
  by auto

(* MELTDOWN_024: RIINA P Protected *)
(* MELTDOWN_024_riina_p (matches Coq) *)
lemma MELTDOWN_024_riina_p: "mdc_p_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_025: RIINA RW Protected *)
(* MELTDOWN_025_riina_rw (matches Coq) *)
lemma MELTDOWN_025_riina_rw: "mdc_rw_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_026: RIINA PK Protected *)
(* MELTDOWN_026_riina_pk (matches Coq) *)
lemma MELTDOWN_026_riina_pk: "mdc_pk_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_027: RIINA BR Protected *)
(* MELTDOWN_027_riina_br (matches Coq) *)
lemma MELTDOWN_027_riina_br: "mdc_br_protected riina_meltdown_config = True"
  by simp

(* MELTDOWN_028: Variant and Mitigation Composition *)
(* MELTDOWN_028_variant_mitigation_composition (matches Coq) *)
lemma MELTDOWN_028_variant_mitigation_composition: "\<forall> c : MeltdownDefenseConfig, all_meltdown_protected c = True \<longrightarrow> meltdown_mitigations_enabled c = True \<longrightarrow> meltdown_fully_protected c = True"
  by simp

(* MELTDOWN_029: Complete Decomposition *)
(* MELTDOWN_029_complete_decomposition (matches Coq) *)
lemma MELTDOWN_029_complete_decomposition: "\<forall> c : MeltdownDefenseConfig, meltdown_fully_protected c = True \<longrightarrow> mdc_us_protected c = True \<and> mdc_p_protected c = True \<and> mdc_rw_protected c = True \<and> mdc_pk_protected c = True \<and> mdc_br_protected c = True \<and> mdc_kpti_enabled c = True \<and> mdc_l1tf_mitigated c = True"
  by auto

end
