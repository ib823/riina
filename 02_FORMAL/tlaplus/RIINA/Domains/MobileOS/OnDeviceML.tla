---- MODULE OnDeviceML ----
\* Copyright (c) 2026 The RIINA Authors. All rights reserved.
\* Auto-generated from 02_FORMAL/coq/domains/mobile_os/OnDeviceML.v (25 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* ModelUpdateState (matches Coq: Inductive ModelUpdateState)
CONSTANTS UpdateIdle, UpdateInProgress, UpdateComplete, UpdateFailed

\* Tensor (matches Coq: Record Tensor)
VARIABLES tensor_shape, tensor_data

\* MLModel (matches Coq: Record MLModel)
VARIABLES model_id, model_weights, model_version, model_deterministic

\* UserData (matches Coq: Record UserData)
VARIABLES data_id, data_content, data_sensitive

\* InferenceRequest (matches Coq: Record InferenceRequest)
VARIABLES req_model, req_input, req_latency_ms, req_max_latency_ms

\* MemoryBudget (matches Coq: Record MemoryBudget)
VARIABLES budget_max_bytes, model_size_bytes

\* ModelUpdate (matches Coq: Record ModelUpdate)
VARIABLES update_old_model, update_new_model, update_state, update_version_increased

\* PrivacyBudget (matches Coq: Record PrivacyBudget)
VARIABLES epsilon, delta, max_epsilon, max_delta

\* Prediction (matches Coq: Record Prediction)
VARIABLES pred_class, pred_confidence, pred_calibrated

\* ModelPolicy (matches Coq: Record ModelPolicy)
VARIABLES policy_model, policy_exportable, policy_on_device_only

\* TrainingData (matches Coq: Record TrainingData)
VARIABLES td_records, td_anonymized, td_pii_removed

\* InputAnalysis (matches Coq: Record InputAnalysis)
VARIABLES ia_input, ia_perturbation_score, ia_threshold, ia_flagged

\* ModelWithFallback (matches Coq: Record ModelWithFallback)
VARIABLES primary_model, fallback_model, primary_available

\* BatchRequest (matches Coq: Record BatchRequest)
VARIABLES batch_id, batch_inputs, batch_sequence

\* QuantizedModel (matches Coq: Record QuantizedModel)
VARIABLES qm_original_weights, qm_quantized_weights, qm_max_error

\* Type invariant
TypeOK ==
  /\ tensor_shape \in BOOLEAN
  /\ tensor_data \in BOOLEAN
  /\ model_id \in BOOLEAN
  /\ model_weights \in BOOLEAN
  /\ model_version \in BOOLEAN
  /\ model_deterministic \in BOOLEAN
  /\ data_id \in BOOLEAN
  /\ data_content \in BOOLEAN
  /\ data_sensitive \in BOOLEAN
  /\ req_model \in BOOLEAN
  /\ req_input \in BOOLEAN
  /\ req_latency_ms \in BOOLEAN
  /\ req_max_latency_ms \in BOOLEAN
  /\ budget_max_bytes \in BOOLEAN
  /\ model_size_bytes \in BOOLEAN
  /\ update_old_model \in BOOLEAN
  /\ update_new_model \in BOOLEAN
  /\ update_state \in BOOLEAN
  /\ update_version_increased \in BOOLEAN
  /\ epsilon \in BOOLEAN
  /\ delta \in BOOLEAN
  /\ max_epsilon \in BOOLEAN
  /\ max_delta \in BOOLEAN
  /\ pred_class \in BOOLEAN
  /\ pred_confidence \in BOOLEAN
  /\ pred_calibrated \in BOOLEAN
  /\ policy_model \in BOOLEAN
  /\ policy_exportable \in BOOLEAN
  /\ policy_on_device_only \in BOOLEAN
  /\ td_records \in BOOLEAN
  /\ td_anonymized \in BOOLEAN
  /\ td_pii_removed \in BOOLEAN
  /\ ia_input \in BOOLEAN
  /\ ia_perturbation_score \in BOOLEAN
  /\ ia_threshold \in BOOLEAN
  /\ ia_flagged \in BOOLEAN
  /\ primary_model \in BOOLEAN
  /\ fallback_model \in BOOLEAN
  /\ primary_available \in BOOLEAN
  /\ batch_id \in BOOLEAN
  /\ batch_inputs \in BOOLEAN
  /\ batch_sequence \in BOOLEAN
  /\ qm_original_weights \in BOOLEAN
  /\ qm_quantized_weights \in BOOLEAN
  /\ qm_max_error \in BOOLEAN

\* Initial state
Init ==
  /\ tensor_shape = TRUE
  /\ tensor_data = TRUE
  /\ model_id = TRUE
  /\ model_weights = TRUE
  /\ model_version = TRUE
  /\ model_deterministic = TRUE
  /\ data_id = TRUE
  /\ data_content = TRUE
  /\ data_sensitive = TRUE
  /\ req_model = TRUE
  /\ req_input = TRUE
  /\ req_latency_ms = TRUE
  /\ req_max_latency_ms = TRUE
  /\ budget_max_bytes = TRUE
  /\ model_size_bytes = TRUE
  /\ update_old_model = TRUE
  /\ update_new_model = TRUE
  /\ update_state = TRUE
  /\ update_version_increased = TRUE
  /\ epsilon = TRUE
  /\ delta = TRUE
  /\ max_epsilon = TRUE
  /\ max_delta = TRUE
  /\ pred_class = TRUE
  /\ pred_confidence = TRUE
  /\ pred_calibrated = TRUE
  /\ policy_model = TRUE
  /\ policy_exportable = TRUE
  /\ policy_on_device_only = TRUE
  /\ td_records = TRUE
  /\ td_anonymized = TRUE
  /\ td_pii_removed = TRUE
  /\ ia_input = TRUE
  /\ ia_perturbation_score = TRUE
  /\ ia_threshold = TRUE
  /\ ia_flagged = TRUE
  /\ primary_model = TRUE
  /\ fallback_model = TRUE
  /\ primary_available = TRUE
  /\ batch_id = TRUE
  /\ batch_inputs = TRUE
  /\ batch_sequence = TRUE
  /\ qm_original_weights = TRUE
  /\ qm_quantized_weights = TRUE
  /\ qm_max_error = TRUE

\* TensorData (matches Coq: Definition TensorData)
TensorData == TRUE

\* compute_inference (matches Coq: Definition compute_inference)
compute_inference(m, input) == TRUE

\* infer (matches Coq: Definition infer)
infer(m, input) == TRUE

\* transmitted (matches Coq: Definition transmitted)
transmitted(d) == TRUE

\* used_for_inference (matches Coq: Definition used_for_inference)
used_for_inference(d, m) == TRUE

\* private_ml_system (matches Coq: Definition private_ml_system)
private_ml_system == TRUE

\* input_shape_valid (matches Coq: Definition input_shape_valid)
input_shape_valid(input) == TRUE

\* output_bounded (matches Coq: Definition output_bounded)
output_bounded(output, bound) == TRUE

\* latency_within_bound (matches Coq: Definition latency_within_bound)
latency_within_bound(r) == TRUE

\* model_fits_memory (matches Coq: Definition model_fits_memory)
model_fits_memory(b) == TRUE

\* update_atomic (matches Coq: Definition update_atomic)
update_atomic(u) == TRUE

\* within_privacy_budget (matches Coq: Definition within_privacy_budget)
within_privacy_budget(pb) == TRUE

\* version_tracked (matches Coq: Definition version_tracked)
version_tracked(m) == TRUE

\* confidence_calibrated (matches Coq: Definition confidence_calibrated)
confidence_calibrated(p) == TRUE

\* model_not_exportable (matches Coq: Definition model_not_exportable)
model_not_exportable(mp) == TRUE

\* data_anonymized (matches Coq: Definition data_anonymized)
data_anonymized(td) == TRUE

\* adversarial_detected (matches Coq: Definition adversarial_detected)
adversarial_detected(ia) == TRUE

\* fallback_ready (matches Coq: Definition fallback_ready)
fallback_ready(mf) == TRUE

\* batch_ordered (matches Coq: Definition batch_ordered)
batch_ordered(br) == TRUE

\* quantization_bounded (matches Coq: Definition quantization_bounded)
quantization_bounded(qm) == TRUE

\* ml_inference_deterministic (matches Coq: Theorem ml_inference_deterministic)
THEOREM ml_inference_deterministic == Init => TypeOK

\* inference_same_input_same_output (matches Coq: Theorem inference_same_input_same_output)
THEOREM inference_same_input_same_output == Init => TypeOK

\* ml_data_private (matches Coq: Theorem ml_data_private)
THEOREM ml_data_private == Init => TypeOK

\* inference_preserves_shape (matches Coq: Theorem inference_preserves_shape)
THEOREM inference_preserves_shape == Init => TypeOK

\* different_model_version_matters (matches Coq: Theorem different_model_version_matters)
THEOREM different_model_version_matters == Init => TypeOK

\* model_input_validated (matches Coq: Theorem model_input_validated)
THEOREM model_input_validated == Init => TypeOK

\* model_output_bounded (matches Coq: Theorem model_output_bounded)
THEOREM model_output_bounded == Init => TypeOK

\* inference_latency_bounded (matches Coq: Theorem inference_latency_bounded)
THEOREM inference_latency_bounded == Init => TypeOK

\* model_size_within_memory (matches Coq: Theorem model_size_within_memory)
THEOREM model_size_within_memory == Init => TypeOK

\* model_update_atomic (matches Coq: Theorem model_update_atomic)
THEOREM model_update_atomic == Init => TypeOK

\* differential_privacy_guaranteed (matches Coq: Theorem differential_privacy_guaranteed)
THEOREM differential_privacy_guaranteed == Init => TypeOK

\* model_version_tracked (matches Coq: Theorem model_version_tracked)
THEOREM model_version_tracked == Init => TypeOK

\* feature_extraction_deterministic (matches Coq: Theorem feature_extraction_deterministic)
THEOREM feature_extraction_deterministic == Init => TypeOK

\* prediction_confidence_calibrated (matches Coq: Theorem prediction_confidence_calibrated)
THEOREM prediction_confidence_calibrated == Init => TypeOK

\* model_not_exported (matches Coq: Theorem model_not_exported)
THEOREM model_not_exported == Init => TypeOK

\* training_data_anonymized (matches Coq: Theorem training_data_anonymized)
THEOREM training_data_anonymized == Init => TypeOK

\* adversarial_input_detected (matches Coq: Theorem adversarial_input_detected)
THEOREM adversarial_input_detected == Init => TypeOK

\* model_fallback_available (matches Coq: Theorem model_fallback_available)
THEOREM model_fallback_available == Init => TypeOK

\* batch_inference_ordered (matches Coq: Theorem batch_inference_ordered)
THEOREM batch_inference_ordered == Init => TypeOK

\* model_quantization_bounded_error (matches Coq: Theorem model_quantization_bounded_error)
THEOREM model_quantization_bounded_error == Init => TypeOK

\* on_device_only_preserves_privacy (matches Coq: Theorem on_device_only_preserves_privacy)
THEOREM on_device_only_preserves_privacy == Init => TypeOK

\* adversarial_implies_high_perturbation (matches Coq: Theorem adversarial_implies_high_perturbation)
THEOREM adversarial_implies_high_perturbation == Init => TypeOK

\* batch_length_consistency (matches Coq: Theorem batch_length_consistency)
THEOREM batch_length_consistency == Init => TypeOK

\* privacy_budget_epsilon_bounded (matches Coq: Theorem privacy_budget_epsilon_bounded)
THEOREM privacy_budget_epsilon_bounded == Init => TypeOK

\* failed_update_preserves_version (matches Coq: Theorem failed_update_preserves_version)
THEOREM failed_update_preserves_version == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<tensor_shape, tensor_data, model_id, model_weights, model_version, model_deterministic, data_id, data_content, data_sensitive, req_model, req_input, req_latency_ms, req_max_latency_ms, budget_max_bytes, model_size_bytes, update_old_model, update_new_model, update_state, update_version_increased, epsilon, delta, max_epsilon, max_delta, pred_class, pred_confidence, pred_calibrated, policy_model, policy_exportable, policy_on_device_only, td_records, td_anonymized, td_pii_removed, ia_input, ia_perturbation_score, ia_threshold, ia_flagged, primary_model, fallback_model, primary_available, batch_id, batch_inputs, batch_sequence, qm_original_weights, qm_quantized_weights, qm_max_error>>

\* Specification
Spec == Init /\ [][Next]_<<tensor_shape, tensor_data, model_id, model_weights, model_version, model_deterministic, data_id, data_content, data_sensitive, req_model, req_input, req_latency_ms, req_max_latency_ms, budget_max_bytes, model_size_bytes, update_old_model, update_new_model, update_state, update_version_increased, epsilon, delta, max_epsilon, max_delta, pred_class, pred_confidence, pred_calibrated, policy_model, policy_exportable, policy_on_device_only, td_records, td_anonymized, td_pii_removed, ia_input, ia_perturbation_score, ia_threshold, ia_flagged, primary_model, fallback_model, primary_available, batch_id, batch_inputs, batch_sequence, qm_original_weights, qm_quantized_weights, qm_max_error>>

====
