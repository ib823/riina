---- MODULE TrackingPrevention ----
\* SPDX-License-Identifier: MPL-2.0
\* Copyright (c) 2026 The RIINA Authors.
\* Auto-generated from 02_FORMAL/coq/domains/mobile_os/TrackingPrevention.v (25 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* ReferrerPolicy (matches Coq: Inductive ReferrerPolicy)
CONSTANTS NoReferrer, StrictOrigin, SameOrigin, FullURL

\* User (matches Coq: Record User)
VARIABLES user_id, tracking_consent_given, consent_scope, consent_timestamp

\* Application (matches Coq: Record Application)
VARIABLES app_id, tracking_enabled, tracking_domains, app_privacy_policy

\* TrackingEvent (matches Coq: Record TrackingEvent)
VARIABLES tracking_app, tracked_user, tracking_type, tracking_data

\* PrivacyState (matches Coq: Record PrivacyState)
VARIABLES tracking_transparency_enabled, app_tracking_requests, approved_tracking, denied_tracking

\* CrossSiteRequest (matches Coq: Record CrossSiteRequest)
VARIABLES csr_source_domain, csr_target_domain, csr_has_tracking_params, csr_blocked

\* FingerprintAttempt (matches Coq: Record FingerprintAttempt)
VARIABLES fp_entropy_bits, fp_max_allowed_bits, fp_prevented

\* CookieRequest (matches Coq: Record CookieRequest)
VARIABLES cookie_domain, cookie_page_domain, cookie_is_third_party, cookie_blocked

\* ResourceLoad (matches Coq: Record ResourceLoad)
VARIABLES res_url_hash, res_size_bytes, res_is_tracking_pixel, res_detected

\* AdvertisingId (matches Coq: Record AdvertisingId)
VARIABLES ad_id_value, ad_id_resettable, ad_id_reset_count

\* AppTrackingRequest (matches Coq: Record AppTrackingRequest)
VARIABLES atr_app_id, atr_user_id, atr_permission_asked, atr_permission_granted

\* LinkDecoration (matches Coq: Record LinkDecoration)
VARIABLES ld_url_hash, ld_tracking_params, ld_stripped

\* BounceTracking (matches Coq: Record BounceTracking)
VARIABLES bt_intermediate_domain, bt_final_domain, bt_bounce_detected, bt_prevented

\* CNAMERecord (matches Coq: Record CNAMERecord)
VARIABLES cname_alias, cname_target, cname_is_tracker, cname_detected

\* StorageAccess (matches Coq: Record StorageAccess)
VARIABLES sa_origin, sa_top_level_origin, sa_partitioned

\* ReferrerConfig (matches Coq: Record ReferrerConfig)
VARIABLES ref_policy, ref_is_strict

\* NetworkRequest (matches Coq: Record NetworkRequest)
VARIABLES nr_destination, nr_ip_masked, nr_uses_relay

\* DeviceGraphAttempt (matches Coq: Record DeviceGraphAttempt)
VARIABLES dg_identifiers_collected, dg_prevented, dg_max_identifiers

\* TrackerList (matches Coq: Record TrackerList)
VARIABLES tl_entries, tl_last_updated, tl_max_age_seconds

\* TrackingReport (matches Coq: Record TrackingReport)
VARIABLES tr_blocked_count, tr_tracker_domains, tr_report_available

\* Type invariant
TypeOK ==
  /\ user_id \in BOOLEAN
  /\ tracking_consent_given \in BOOLEAN
  /\ consent_scope \in BOOLEAN
  /\ consent_timestamp \in BOOLEAN
  /\ app_id \in BOOLEAN
  /\ tracking_enabled \in BOOLEAN
  /\ tracking_domains \in BOOLEAN
  /\ app_privacy_policy \in BOOLEAN
  /\ tracking_app \in BOOLEAN
  /\ tracked_user \in BOOLEAN
  /\ tracking_type \in BOOLEAN
  /\ tracking_data \in BOOLEAN
  /\ tracking_transparency_enabled \in BOOLEAN
  /\ app_tracking_requests \in BOOLEAN
  /\ approved_tracking \in BOOLEAN
  /\ denied_tracking \in BOOLEAN
  /\ csr_source_domain \in BOOLEAN
  /\ csr_target_domain \in BOOLEAN
  /\ csr_has_tracking_params \in BOOLEAN
  /\ csr_blocked \in BOOLEAN
  /\ fp_entropy_bits \in BOOLEAN
  /\ fp_max_allowed_bits \in BOOLEAN
  /\ fp_prevented \in BOOLEAN
  /\ cookie_domain \in BOOLEAN
  /\ cookie_page_domain \in BOOLEAN
  /\ cookie_is_third_party \in BOOLEAN
  /\ cookie_blocked \in BOOLEAN
  /\ res_url_hash \in BOOLEAN
  /\ res_size_bytes \in BOOLEAN
  /\ res_is_tracking_pixel \in BOOLEAN
  /\ res_detected \in BOOLEAN
  /\ ad_id_value \in BOOLEAN
  /\ ad_id_resettable \in BOOLEAN
  /\ ad_id_reset_count \in BOOLEAN
  /\ atr_app_id \in BOOLEAN
  /\ atr_user_id \in BOOLEAN
  /\ atr_permission_asked \in BOOLEAN
  /\ atr_permission_granted \in BOOLEAN
  /\ ld_url_hash \in BOOLEAN
  /\ ld_tracking_params \in BOOLEAN
  /\ ld_stripped \in BOOLEAN
  /\ bt_intermediate_domain \in BOOLEAN
  /\ bt_final_domain \in BOOLEAN
  /\ bt_bounce_detected \in BOOLEAN
  /\ bt_prevented \in BOOLEAN
  /\ cname_alias \in BOOLEAN
  /\ cname_target \in BOOLEAN
  /\ cname_is_tracker \in BOOLEAN
  /\ cname_detected \in BOOLEAN
  /\ sa_origin \in BOOLEAN
  /\ sa_top_level_origin \in BOOLEAN
  /\ sa_partitioned \in BOOLEAN
  /\ ref_policy \in BOOLEAN
  /\ ref_is_strict \in BOOLEAN
  /\ nr_destination \in BOOLEAN
  /\ nr_ip_masked \in BOOLEAN
  /\ nr_uses_relay \in BOOLEAN
  /\ dg_identifiers_collected \in BOOLEAN
  /\ dg_prevented \in BOOLEAN
  /\ dg_max_identifiers \in BOOLEAN
  /\ tl_entries \in BOOLEAN
  /\ tl_last_updated \in BOOLEAN
  /\ tl_max_age_seconds \in BOOLEAN
  /\ tr_blocked_count \in BOOLEAN
  /\ tr_tracker_domains \in BOOLEAN
  /\ tr_report_available \in BOOLEAN

\* Initial state
Init ==
  /\ user_id = TRUE
  /\ tracking_consent_given = TRUE
  /\ consent_scope = TRUE
  /\ consent_timestamp = TRUE
  /\ app_id = TRUE
  /\ tracking_enabled = TRUE
  /\ tracking_domains = TRUE
  /\ app_privacy_policy = TRUE
  /\ tracking_app = TRUE
  /\ tracked_user = TRUE
  /\ tracking_type = TRUE
  /\ tracking_data = TRUE
  /\ tracking_transparency_enabled = TRUE
  /\ app_tracking_requests = TRUE
  /\ approved_tracking = TRUE
  /\ denied_tracking = TRUE
  /\ csr_source_domain = TRUE
  /\ csr_target_domain = TRUE
  /\ csr_has_tracking_params = TRUE
  /\ csr_blocked = TRUE
  /\ fp_entropy_bits = TRUE
  /\ fp_max_allowed_bits = TRUE
  /\ fp_prevented = TRUE
  /\ cookie_domain = TRUE
  /\ cookie_page_domain = TRUE
  /\ cookie_is_third_party = TRUE
  /\ cookie_blocked = TRUE
  /\ res_url_hash = TRUE
  /\ res_size_bytes = TRUE
  /\ res_is_tracking_pixel = TRUE
  /\ res_detected = TRUE
  /\ ad_id_value = TRUE
  /\ ad_id_resettable = TRUE
  /\ ad_id_reset_count = TRUE
  /\ atr_app_id = TRUE
  /\ atr_user_id = TRUE
  /\ atr_permission_asked = TRUE
  /\ atr_permission_granted = TRUE
  /\ ld_url_hash = TRUE
  /\ ld_tracking_params = TRUE
  /\ ld_stripped = TRUE
  /\ bt_intermediate_domain = TRUE
  /\ bt_final_domain = TRUE
  /\ bt_bounce_detected = TRUE
  /\ bt_prevented = TRUE
  /\ cname_alias = TRUE
  /\ cname_target = TRUE
  /\ cname_is_tracker = TRUE
  /\ cname_detected = TRUE
  /\ sa_origin = TRUE
  /\ sa_top_level_origin = TRUE
  /\ sa_partitioned = TRUE
  /\ ref_policy = TRUE
  /\ ref_is_strict = TRUE
  /\ nr_destination = TRUE
  /\ nr_ip_masked = TRUE
  /\ nr_uses_relay = TRUE
  /\ dg_identifiers_collected = TRUE
  /\ dg_prevented = TRUE
  /\ dg_max_identifiers = TRUE
  /\ tl_entries = TRUE
  /\ tl_last_updated = TRUE
  /\ tl_max_age_seconds = TRUE
  /\ tr_blocked_count = TRUE
  /\ tr_tracker_domains = TRUE
  /\ tr_report_available = TRUE

\* consent_scope_invariant (matches Coq: Definition consent_scope_invariant)
consent_scope_invariant(user) == TRUE

\* explicit_consent (matches Coq: Definition explicit_consent)
explicit_consent(user, app) == TRUE

\* tracks (matches Coq: Definition tracks)
tracks(app, user) == TRUE

\* privacy_state_well_formed (matches Coq: Definition privacy_state_well_formed)
privacy_state_well_formed(ps) == TRUE

\* tracking_requested (matches Coq: Definition tracking_requested)
tracking_requested(ps, app, user) == TRUE

\* tracking_approved (matches Coq: Definition tracking_approved)
tracking_approved(ps, app, user) == TRUE

\* tracking_allowed (matches Coq: Definition tracking_allowed)
tracking_allowed(ps, app, user) == TRUE

\* tracking_event_well_formed (matches Coq: Definition tracking_event_well_formed)
tracking_event_well_formed(event) == TRUE

\* cross_site_tracking_blocked (matches Coq: Definition cross_site_tracking_blocked)
cross_site_tracking_blocked(csr) == TRUE

\* fingerprinting_prevented (matches Coq: Definition fingerprinting_prevented)
fingerprinting_prevented(fa) == TRUE

\* third_party_cookies_blocked (matches Coq: Definition third_party_cookies_blocked)
third_party_cookies_blocked(cr) == TRUE

\* tracking_pixel_detected (matches Coq: Definition tracking_pixel_detected)
tracking_pixel_detected(rl) == TRUE

\* advertising_id_resettable (matches Coq: Definition advertising_id_resettable)
advertising_id_resettable(aid) == TRUE

\* app_tracking_permission_required (matches Coq: Definition app_tracking_permission_required)
app_tracking_permission_required(atr) == TRUE

\* link_decoration_stripped (matches Coq: Definition link_decoration_stripped)
link_decoration_stripped(ld) == TRUE

\* bounce_tracking_prevented (matches Coq: Definition bounce_tracking_prevented)
bounce_tracking_prevented(bt) == TRUE

\* cname_cloaking_detected (matches Coq: Definition cname_cloaking_detected)
cname_cloaking_detected(cr) == TRUE

\* storage_access_partitioned (matches Coq: Definition storage_access_partitioned)
storage_access_partitioned(sa) == TRUE

\* referrer_policy_strict (matches Coq: Definition referrer_policy_strict)
referrer_policy_strict(rc) == TRUE

\* ip_address_masked (matches Coq: Definition ip_address_masked)
ip_address_masked(nr) == TRUE

\* device_graph_prevented (matches Coq: Definition device_graph_prevented)
device_graph_prevented(dg) == TRUE

\* tracker_list_updated (matches Coq: Definition tracker_list_updated)
tracker_list_updated(tl) == TRUE

\* tracking_report_available (matches Coq: Definition tracking_report_available)
tracking_report_available(tr) == TRUE

\* no_tracking_without_consent (matches Coq: Theorem no_tracking_without_consent)
THEOREM no_tracking_without_consent == Init => TypeOK

\* tracking_requires_transparency_prompt (matches Coq: Theorem tracking_requires_transparency_prompt)
THEOREM tracking_requires_transparency_prompt == Init => TypeOK

\* denied_tracking_not_approved (matches Coq: Theorem denied_tracking_not_approved)
THEOREM denied_tracking_not_approved == Init => TypeOK

\* consent_revocation_effective (matches Coq: Theorem consent_revocation_effective)
THEOREM consent_revocation_effective == Init => TypeOK

\* no_consent_no_data (matches Coq: Theorem no_consent_no_data)
THEOREM no_consent_no_data == Init => TypeOK

\* cross_site_tracking_blocked_thm (matches Coq: Theorem cross_site_tracking_blocked_thm)
THEOREM cross_site_tracking_blocked_thm == Init => TypeOK

\* fingerprinting_prevented_thm (matches Coq: Theorem fingerprinting_prevented_thm)
THEOREM fingerprinting_prevented_thm == Init => TypeOK

\* third_party_cookies_blocked_thm (matches Coq: Theorem third_party_cookies_blocked_thm)
THEOREM third_party_cookies_blocked_thm == Init => TypeOK

\* tracking_pixel_detected_thm (matches Coq: Theorem tracking_pixel_detected_thm)
THEOREM tracking_pixel_detected_thm == Init => TypeOK

\* advertising_id_resettable_thm (matches Coq: Theorem advertising_id_resettable_thm)
THEOREM advertising_id_resettable_thm == Init => TypeOK

\* app_tracking_permission_required_thm (matches Coq: Theorem app_tracking_permission_required_thm)
THEOREM app_tracking_permission_required_thm == Init => TypeOK

\* link_decoration_stripped_thm (matches Coq: Theorem link_decoration_stripped_thm)
THEOREM link_decoration_stripped_thm == Init => TypeOK

\* bounce_tracking_prevented_thm (matches Coq: Theorem bounce_tracking_prevented_thm)
THEOREM bounce_tracking_prevented_thm == Init => TypeOK

\* cname_cloaking_detected_thm (matches Coq: Theorem cname_cloaking_detected_thm)
THEOREM cname_cloaking_detected_thm == Init => TypeOK

\* storage_access_partitioned_thm (matches Coq: Theorem storage_access_partitioned_thm)
THEOREM storage_access_partitioned_thm == Init => TypeOK

\* referrer_policy_strict_thm (matches Coq: Theorem referrer_policy_strict_thm)
THEOREM referrer_policy_strict_thm == Init => TypeOK

\* ip_address_masked_thm (matches Coq: Theorem ip_address_masked_thm)
THEOREM ip_address_masked_thm == Init => TypeOK

\* device_graph_prevented_thm (matches Coq: Theorem device_graph_prevented_thm)
THEOREM device_graph_prevented_thm == Init => TypeOK

\* tracker_list_updated_thm (matches Coq: Theorem tracker_list_updated_thm)
THEOREM tracker_list_updated_thm == Init => TypeOK

\* tracking_report_available_thm (matches Coq: Theorem tracking_report_available_thm)
THEOREM tracking_report_available_thm == Init => TypeOK

\* referrer_policy_options (matches Coq: Theorem referrer_policy_options)
THEOREM referrer_policy_options == Init => TypeOK

\* tracker_list_non_empty (matches Coq: Theorem tracker_list_non_empty)
THEOREM tracker_list_non_empty == Init => TypeOK

\* no_tracking_without_permission_request (matches Coq: Theorem no_tracking_without_permission_request)
THEOREM no_tracking_without_permission_request == Init => TypeOK

\* revocation_prevents_future_tracking (matches Coq: Theorem revocation_prevents_future_tracking)
THEOREM revocation_prevents_future_tracking == Init => TypeOK

\* ip_masked_via_relay (matches Coq: Theorem ip_masked_via_relay)
THEOREM ip_masked_via_relay == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<user_id, tracking_consent_given, consent_scope, consent_timestamp, app_id, tracking_enabled, tracking_domains, app_privacy_policy, tracking_app, tracked_user, tracking_type, tracking_data, tracking_transparency_enabled, app_tracking_requests, approved_tracking, denied_tracking, csr_source_domain, csr_target_domain, csr_has_tracking_params, csr_blocked, fp_entropy_bits, fp_max_allowed_bits, fp_prevented, cookie_domain, cookie_page_domain, cookie_is_third_party, cookie_blocked, res_url_hash, res_size_bytes, res_is_tracking_pixel, res_detected, ad_id_value, ad_id_resettable, ad_id_reset_count, atr_app_id, atr_user_id, atr_permission_asked, atr_permission_granted, ld_url_hash, ld_tracking_params, ld_stripped, bt_intermediate_domain, bt_final_domain, bt_bounce_detected, bt_prevented, cname_alias, cname_target, cname_is_tracker, cname_detected, sa_origin, sa_top_level_origin, sa_partitioned, ref_policy, ref_is_strict, nr_destination, nr_ip_masked, nr_uses_relay, dg_identifiers_collected, dg_prevented, dg_max_identifiers, tl_entries, tl_last_updated, tl_max_age_seconds, tr_blocked_count, tr_tracker_domains, tr_report_available>>

\* Specification
Spec == Init /\ [][Next]_<<user_id, tracking_consent_given, consent_scope, consent_timestamp, app_id, tracking_enabled, tracking_domains, app_privacy_policy, tracking_app, tracked_user, tracking_type, tracking_data, tracking_transparency_enabled, app_tracking_requests, approved_tracking, denied_tracking, csr_source_domain, csr_target_domain, csr_has_tracking_params, csr_blocked, fp_entropy_bits, fp_max_allowed_bits, fp_prevented, cookie_domain, cookie_page_domain, cookie_is_third_party, cookie_blocked, res_url_hash, res_size_bytes, res_is_tracking_pixel, res_detected, ad_id_value, ad_id_resettable, ad_id_reset_count, atr_app_id, atr_user_id, atr_permission_asked, atr_permission_granted, ld_url_hash, ld_tracking_params, ld_stripped, bt_intermediate_domain, bt_final_domain, bt_bounce_detected, bt_prevented, cname_alias, cname_target, cname_is_tracker, cname_detected, sa_origin, sa_top_level_origin, sa_partitioned, ref_policy, ref_is_strict, nr_destination, nr_ip_masked, nr_uses_relay, dg_identifiers_collected, dg_prevented, dg_max_identifiers, tl_entries, tl_last_updated, tl_max_age_seconds, tr_blocked_count, tr_tracker_domains, tr_report_available>>

====
