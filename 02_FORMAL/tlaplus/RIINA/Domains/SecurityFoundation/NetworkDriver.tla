---- MODULE NetworkDriver ----
\* SPDX-License-Identifier: MPL-2.0
\* Copyright (c) 2026 The RIINA Authors.
\* Auto-generated from 02_FORMAL/coq/domains/security_foundation/NetworkDriver.v (21 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* AppId (matches Coq: Inductive AppId)
CONSTANTS App

\* SocketId (matches Coq: Inductive SocketId)
CONSTANTS SockId

\* Application (matches Coq: Record Application)
VARIABLES app_id, app_network_perm

\* Socket (matches Coq: Record Socket)
VARIABLES socket_id, socket_owner, socket_port, socket_bound

\* NetworkState (matches Coq: Record NetworkState)
VARIABLES all_sockets, firewall_enabled

\* FirewallRule (matches Coq: Record FirewallRule)
VARIABLES fw_src_port, fw_dst_port, fw_allowed

\* ExtNetworkState (matches Coq: Record ExtNetworkState)
VARIABLES ext_sockets, ext_firewall_enabled, ext_firewall_rules

\* Type invariant
TypeOK ==
  /\ app_id \in BOOLEAN
  /\ app_network_perm \in BOOLEAN
  /\ socket_id \in BOOLEAN
  /\ socket_owner \in BOOLEAN
  /\ socket_port \in BOOLEAN
  /\ socket_bound \in BOOLEAN
  /\ all_sockets \in BOOLEAN
  /\ firewall_enabled \in BOOLEAN
  /\ fw_src_port \in BOOLEAN
  /\ fw_dst_port \in BOOLEAN
  /\ fw_allowed \in BOOLEAN
  /\ ext_sockets \in BOOLEAN
  /\ ext_firewall_enabled \in BOOLEAN
  /\ ext_firewall_rules \in BOOLEAN

\* Initial state
Init ==
  /\ app_id = TRUE
  /\ app_network_perm = TRUE
  /\ socket_id = TRUE
  /\ socket_owner = TRUE
  /\ socket_port = TRUE
  /\ socket_bound = TRUE
  /\ all_sockets = TRUE
  /\ firewall_enabled = TRUE
  /\ fw_src_port = TRUE
  /\ fw_dst_port = TRUE
  /\ fw_allowed = TRUE
  /\ ext_sockets = TRUE
  /\ ext_firewall_enabled = TRUE
  /\ ext_firewall_rules = TRUE

\* owns_socket (matches Coq: Definition owns_socket)
owns_socket(app, sock) == TRUE

\* socket_usable (matches Coq: Definition socket_usable)
socket_usable(sock) == TRUE

\* has_network_permission (matches Coq: Definition has_network_permission)
has_network_permission(app) == TRUE

\* network_isolation (matches Coq: Theorem network_isolation)
THEOREM network_isolation == Init => TypeOK

\* socket_ownership_exclusive (matches Coq: Theorem socket_ownership_exclusive)
THEOREM socket_ownership_exclusive == Init => TypeOK

\* unbound_socket_not_usable (matches Coq: Theorem unbound_socket_not_usable)
THEOREM unbound_socket_not_usable == Init => TypeOK

\* send_requires_network_permission (matches Coq: Theorem send_requires_network_permission)
THEOREM send_requires_network_permission == Init => TypeOK

\* receive_requires_network_permission (matches Coq: Theorem receive_requires_network_permission)
THEOREM receive_requires_network_permission == Init => TypeOK

\* no_perm_blocks_send (matches Coq: Theorem no_perm_blocks_send)
THEOREM no_perm_blocks_send == Init => TypeOK

\* no_perm_blocks_receive (matches Coq: Theorem no_perm_blocks_receive)
THEOREM no_perm_blocks_receive == Init => TypeOK

\* unbound_blocks_send (matches Coq: Theorem unbound_blocks_send)
THEOREM unbound_blocks_send == Init => TypeOK

\* unbound_blocks_receive (matches Coq: Theorem unbound_blocks_receive)
THEOREM unbound_blocks_receive == Init => TypeOK

\* default_deny_firewall (matches Coq: Theorem default_deny_firewall)
THEOREM default_deny_firewall == Init => TypeOK

\* cross_app_socket_impossible (matches Coq: Theorem cross_app_socket_impossible)
THEOREM cross_app_socket_impossible == Init => TypeOK

\* cross_app_receive_impossible (matches Coq: Theorem cross_app_receive_impossible)
THEOREM cross_app_receive_impossible == Init => TypeOK

\* send_implies_bound (matches Coq: Theorem send_implies_bound)
THEOREM send_implies_bound == Init => TypeOK

\* receive_implies_bound (matches Coq: Theorem receive_implies_bound)
THEOREM receive_implies_bound == Init => TypeOK

\* socket_isolation_by_owner (matches Coq: Theorem socket_isolation_by_owner)
THEOREM socket_isolation_by_owner == Init => TypeOK

\* access_control_consistent (matches Coq: Theorem access_control_consistent)
THEOREM access_control_consistent == Init => TypeOK

\* network_perm_required_both_directions (matches Coq: Theorem network_perm_required_both_directions)
THEOREM network_perm_required_both_directions == Init => TypeOK

\* full_network_isolation (matches Coq: Theorem full_network_isolation)
THEOREM full_network_isolation == Init => TypeOK

\* bound_implies_usable (matches Coq: Theorem bound_implies_usable)
THEOREM bound_implies_usable == Init => TypeOK

\* firewall_protects (matches Coq: Theorem firewall_protects)
THEOREM firewall_protects == Init => TypeOK

\* socket_port_nonneg (matches Coq: Theorem socket_port_nonneg)
THEOREM socket_port_nonneg == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<app_id, app_network_perm, socket_id, socket_owner, socket_port, socket_bound, all_sockets, firewall_enabled, fw_src_port, fw_dst_port, fw_allowed, ext_sockets, ext_firewall_enabled, ext_firewall_rules>>

\* Specification
Spec == Init /\ [][Next]_<<app_id, app_network_perm, socket_id, socket_owner, socket_port, socket_bound, all_sockets, firewall_enabled, fw_src_port, fw_dst_port, fw_allowed, ext_sockets, ext_firewall_enabled, ext_firewall_rules>>

====
