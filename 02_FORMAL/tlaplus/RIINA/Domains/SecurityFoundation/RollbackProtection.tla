---- MODULE RollbackProtection ----
\* SPDX-License-Identifier: MPL-2.0
\* Copyright (c) 2026 The RIINA Authors.
\* Auto-generated from 02_FORMAL/coq/domains/security_foundation/RollbackProtection.v (21 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* ComponentId (matches Coq: Inductive ComponentId)
CONSTANTS CompId

\* Version (matches Coq: Record Version)
VARIABLES major, minor, patch, build

\* VersionedComponent (matches Coq: Record VersionedComponent)
VARIABLES comp_id, comp_version, comp_hash

\* MinVersionEntry (matches Coq: Record MinVersionEntry)
VARIABLES min_comp_id, min_version, stored_in_hardware

\* RollbackState (matches Coq: Record RollbackState)
VARIABLES minimum_versions, current_versions, anti_rollback_enabled

\* Type invariant
TypeOK ==
  /\ major \in BOOLEAN
  /\ minor \in BOOLEAN
  /\ patch \in BOOLEAN
  /\ build \in BOOLEAN
  /\ comp_id \in BOOLEAN
  /\ comp_version \in BOOLEAN
  /\ comp_hash \in BOOLEAN
  /\ min_comp_id \in BOOLEAN
  /\ min_version \in BOOLEAN
  /\ stored_in_hardware \in BOOLEAN
  /\ minimum_versions \in BOOLEAN
  /\ current_versions \in BOOLEAN
  /\ anti_rollback_enabled \in BOOLEAN

\* Initial state
Init ==
  /\ major = TRUE
  /\ minor = TRUE
  /\ patch = TRUE
  /\ build = TRUE
  /\ comp_id = TRUE
  /\ comp_version = TRUE
  /\ comp_hash = TRUE
  /\ min_comp_id = TRUE
  /\ min_version = TRUE
  /\ stored_in_hardware = TRUE
  /\ minimum_versions = TRUE
  /\ current_versions = TRUE
  /\ anti_rollback_enabled = TRUE

\* version_lt (matches Coq: Definition version_lt)
version_lt == TRUE

\* version_le (matches Coq: Definition version_le)
version_le == TRUE

\* initial_rollback_state (matches Coq: Definition initial_rollback_state)
initial_rollback_state == TRUE

\* version_allowed (matches Coq: Definition version_allowed)
version_allowed(st, comp, ver) == TRUE

\* can_boot_version (matches Coq: Definition can_boot_version)
can_boot_version(st, comp) == TRUE

\* update_min_version (matches Coq: Definition update_min_version)
update_min_version(st, comp, ver, hw) == TRUE

\* record_current_version (matches Coq: Definition record_current_version)
record_current_version(st, comp) == TRUE

\* advance_min_to_current (matches Coq: Definition advance_min_to_current)
advance_min_to_current(st, comp) == TRUE

\* is_rollback (matches Coq: Definition is_rollback)
is_rollback(st, comp, ver) == TRUE

\* can_boot_prop (matches Coq: Definition can_boot_prop)
can_boot_prop(st, comp) == TRUE

\* rollback_enforced (matches Coq: Definition rollback_enforced)
rollback_enforced(st) == TRUE

\* rollback_protection (matches Coq: Theorem rollback_protection)
THEOREM rollback_protection == Init => TypeOK

\* old_version_cannot_boot (matches Coq: Theorem old_version_cannot_boot)
THEOREM old_version_cannot_boot == Init => TypeOK

\* current_or_newer_allowed (matches Coq: Theorem current_or_newer_allowed)
THEOREM current_or_newer_allowed == Init => TypeOK

\* min_version_monotonic (matches Coq: Theorem min_version_monotonic)
THEOREM min_version_monotonic == Init => TypeOK

\* no_minimum_any_allowed (matches Coq: Theorem no_minimum_any_allowed)
THEOREM no_minimum_any_allowed == Init => TypeOK

\* disabled_rollback_allows_all (matches Coq: Theorem disabled_rollback_allows_all)
THEOREM disabled_rollback_allows_all == Init => TypeOK

\* version_lt_irreflexive (matches Coq: Theorem version_lt_irreflexive)
THEOREM version_lt_irreflexive == Init => TypeOK

\* same_version_always_allowed (matches Coq: Theorem same_version_always_allowed)
THEOREM same_version_always_allowed == Init => TypeOK

\* update_stores_new_min (matches Coq: Theorem update_stores_new_min)
THEOREM update_stores_new_min == Init => TypeOK

\* record_preserves_anti_rollback (matches Coq: Theorem record_preserves_anti_rollback)
THEOREM record_preserves_anti_rollback == Init => TypeOK

\* record_preserves_minimums (matches Coq: Theorem record_preserves_minimums)
THEOREM record_preserves_minimums == Init => TypeOK

\* update_preserves_anti_rollback (matches Coq: Theorem update_preserves_anti_rollback)
THEOREM update_preserves_anti_rollback == Init => TypeOK

\* advance_preserves_anti_rollback (matches Coq: Theorem advance_preserves_anti_rollback)
THEOREM advance_preserves_anti_rollback == Init => TypeOK

\* equal_version_not_rollback (matches Coq: Theorem equal_version_not_rollback)
THEOREM equal_version_not_rollback == Init => TypeOK

\* initial_state_allows_all (matches Coq: Theorem initial_state_allows_all)
THEOREM initial_state_allows_all == Init => TypeOK

\* initial_state_no_minimums (matches Coq: Theorem initial_state_no_minimums)
THEOREM initial_state_no_minimums == Init => TypeOK

\* initial_state_no_current (matches Coq: Theorem initial_state_no_current)
THEOREM initial_state_no_current == Init => TypeOK

\* enforced_detects_rollback (matches Coq: Theorem enforced_detects_rollback)
THEOREM enforced_detects_rollback == Init => TypeOK

\* hardware_stored_minimum_recorded (matches Coq: Theorem hardware_stored_minimum_recorded)
THEOREM hardware_stored_minimum_recorded == Init => TypeOK

\* advance_missing_current_identity (matches Coq: Theorem advance_missing_current_identity)
THEOREM advance_missing_current_identity == Init => TypeOK

\* independent_component_minimums (matches Coq: Theorem independent_component_minimums)
THEOREM independent_component_minimums == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<major, minor, patch, build, comp_id, comp_version, comp_hash, min_comp_id, min_version, stored_in_hardware, minimum_versions, current_versions, anti_rollback_enabled>>

\* Specification
Spec == Init /\ [][Next]_<<major, minor, patch, build, comp_id, comp_version, comp_hash, min_comp_id, min_version, stored_in_hardware, minimum_versions, current_versions, anti_rollback_enabled>>

====
