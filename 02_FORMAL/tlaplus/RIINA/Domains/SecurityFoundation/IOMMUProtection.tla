---- MODULE IOMMUProtection ----
\* Copyright (c) 2026 The RIINA Authors. All rights reserved.
\* Auto-generated from 02_FORMAL/coq/domains/security_foundation/IOMMUProtection.v (22 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* DeviceId (matches Coq: Inductive DeviceId)
CONSTANTS DevId

\* VMId (matches Coq: Inductive VMId)
CONSTANTS VM

\* Address (matches Coq: Inductive Address)
CONSTANTS Addr

\* Device (matches Coq: Record Device)
VARIABLES dev_id, dev_bus, dev_function

\* VirtualMachine (matches Coq: Record VirtualMachine)
VARIABLES vm_id, vm_dma_base, vm_dma_size

\* IOMMUConfig (matches Coq: Record IOMMUConfig)
VARIABLES config_device, config_allowed_base, config_allowed_size, config_locked

\* IOMMU (matches Coq: Record IOMMU)
VARIABLES iommu_id, iommu_configs, iommu_enabled

\* Type invariant
TypeOK ==
  /\ dev_id \in BOOLEAN
  /\ dev_bus \in BOOLEAN
  /\ dev_function \in BOOLEAN
  /\ vm_id \in BOOLEAN
  /\ vm_dma_base \in BOOLEAN
  /\ vm_dma_size \in BOOLEAN
  /\ config_device \in BOOLEAN
  /\ config_allowed_base \in BOOLEAN
  /\ config_allowed_size \in BOOLEAN
  /\ config_locked \in BOOLEAN
  /\ iommu_id \in BOOLEAN
  /\ iommu_configs \in BOOLEAN
  /\ iommu_enabled \in BOOLEAN

\* Initial state
Init ==
  /\ dev_id = TRUE
  /\ dev_bus = TRUE
  /\ dev_function = TRUE
  /\ vm_id = TRUE
  /\ vm_dma_base = TRUE
  /\ vm_dma_size = TRUE
  /\ config_device = TRUE
  /\ config_allowed_base = TRUE
  /\ config_allowed_size = TRUE
  /\ config_locked = TRUE
  /\ iommu_id = TRUE
  /\ iommu_configs = TRUE
  /\ iommu_enabled = TRUE

\* address_in_range (matches Coq: Definition address_in_range)
address_in_range(addr, cfg) == TRUE

\* iommu_permits_dma (matches Coq: Definition iommu_permits_dma)
iommu_permits_dma(iommu, dev, addr) == TRUE

\* guest_isolated_from_iommu (matches Coq: Definition guest_isolated_from_iommu)
guest_isolated_from_iommu(vm, iommu) == TRUE

\* kernel_region_base (matches Coq: Definition kernel_region_base)
kernel_region_base == TRUE

\* kernel_region_size (matches Coq: Definition kernel_region_size)
kernel_region_size == TRUE

\* dma_isolation (matches Coq: Theorem dma_isolation)
THEOREM dma_isolation == Init => TypeOK

\* iommu_config_protected (matches Coq: Theorem iommu_config_protected)
THEOREM iommu_config_protected == Init => TypeOK

\* iommu_config_protected_v2 (matches Coq: Theorem iommu_config_protected_v2)
THEOREM iommu_config_protected_v2 == Init => TypeOK

\* dma_requires_iommu_enabled (matches Coq: Theorem dma_requires_iommu_enabled)
THEOREM dma_requires_iommu_enabled == Init => TypeOK

\* unconfigured_device_no_dma (matches Coq: Theorem unconfigured_device_no_dma)
THEOREM unconfigured_device_no_dma == Init => TypeOK

\* out_of_range_dma_blocked (matches Coq: Theorem out_of_range_dma_blocked)
THEOREM out_of_range_dma_blocked == Init => TypeOK

\* iommu_lockdown_effective (matches Coq: Theorem iommu_lockdown_effective)
THEOREM iommu_lockdown_effective == Init => TypeOK

\* dma_isolation_enforced (matches Coq: Theorem dma_isolation_enforced)
THEOREM dma_isolation_enforced == Init => TypeOK

\* device_address_bounded (matches Coq: Theorem device_address_bounded)
THEOREM device_address_bounded == Init => TypeOK

\* mapping_table_consistent (matches Coq: Theorem mapping_table_consistent)
THEOREM mapping_table_consistent == Init => TypeOK

\* no_dma_to_kernel (matches Coq: Theorem no_dma_to_kernel)
THEOREM no_dma_to_kernel == Init => TypeOK

\* iommu_bypass_impossible (matches Coq: Theorem iommu_bypass_impossible)
THEOREM iommu_bypass_impossible == Init => TypeOK

\* address_range_lower_bound (matches Coq: Theorem address_range_lower_bound)
THEOREM address_range_lower_bound == Init => TypeOK

\* address_range_upper_bound (matches Coq: Theorem address_range_upper_bound)
THEOREM address_range_upper_bound == Init => TypeOK

\* device_identity_verified (matches Coq: Theorem device_identity_verified)
THEOREM device_identity_verified == Init => TypeOK

\* empty_config_denies_all (matches Coq: Theorem empty_config_denies_all)
THEOREM empty_config_denies_all == Init => TypeOK

\* disabled_iommu_denies_all (matches Coq: Theorem disabled_iommu_denies_all)
THEOREM disabled_iommu_denies_all == Init => TypeOK

\* locked_config_invariant (matches Coq: Theorem locked_config_invariant)
THEOREM locked_config_invariant == Init => TypeOK

\* zero_size_config_denies (matches Coq: Theorem zero_size_config_denies)
THEOREM zero_size_config_denies == Init => TypeOK

\* find_device_config_none_not_in (matches Coq: Theorem find_device_config_none_not_in)
THEOREM find_device_config_none_not_in == Init => TypeOK

\* find_device_config_some_matches (matches Coq: Theorem find_device_config_some_matches)
THEOREM find_device_config_some_matches == Init => TypeOK

\* independent_device_configs (matches Coq: Theorem independent_device_configs)
THEOREM independent_device_configs == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<dev_id, dev_bus, dev_function, vm_id, vm_dma_base, vm_dma_size, config_device, config_allowed_base, config_allowed_size, config_locked, iommu_id, iommu_configs, iommu_enabled>>

\* Specification
Spec == Init /\ [][Next]_<<dev_id, dev_bus, dev_function, vm_id, vm_dma_base, vm_dma_size, config_device, config_allowed_base, config_allowed_size, config_locked, iommu_id, iommu_configs, iommu_enabled>>

====
