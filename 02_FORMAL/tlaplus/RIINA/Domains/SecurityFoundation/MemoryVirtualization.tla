---- MODULE MemoryVirtualization ----
\* Copyright (c) 2026 The RIINA Authors. All rights reserved.
\* Auto-generated from 02_FORMAL/coq/domains/security_foundation/MemoryVirtualization.v (21 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* VMId (matches Coq: Inductive VMId)
CONSTANTS VM

\* ProcessId (matches Coq: Inductive ProcessId)
CONSTANTS ProcId

\* Process (matches Coq: Record Process)
VARIABLES proc_id, proc_vm_create_cap

\* VirtualMachine (matches Coq: Record VirtualMachine)
VARIABLES vm_id, vm_ept_base, vm_memory_size, vm_creator

\* EPTEntry (matches Coq: Record EPTEntry)
VARIABLES ept_gpa, ept_hpa, ept_permissions, ept_valid

\* ExtendedPageTable (matches Coq: Record ExtendedPageTable)
VARIABLES ept_id, ept_owner, ept_entries, ept_locked

\* MemVirtState (matches Coq: Record MemVirtState)
VARIABLES all_epts, all_vms

\* Type invariant
TypeOK ==
  /\ proc_id \in BOOLEAN
  /\ proc_vm_create_cap \in BOOLEAN
  /\ vm_id \in BOOLEAN
  /\ vm_ept_base \in BOOLEAN
  /\ vm_memory_size \in BOOLEAN
  /\ vm_creator \in BOOLEAN
  /\ ept_gpa \in BOOLEAN
  /\ ept_hpa \in BOOLEAN
  /\ ept_permissions \in BOOLEAN
  /\ ept_valid \in BOOLEAN
  /\ ept_id \in BOOLEAN
  /\ ept_owner \in BOOLEAN
  /\ ept_entries \in BOOLEAN
  /\ ept_locked \in BOOLEAN
  /\ all_epts \in BOOLEAN
  /\ all_vms \in BOOLEAN

\* Initial state
Init ==
  /\ proc_id = TRUE
  /\ proc_vm_create_cap = TRUE
  /\ vm_id = TRUE
  /\ vm_ept_base = TRUE
  /\ vm_memory_size = TRUE
  /\ vm_creator = TRUE
  /\ ept_gpa = TRUE
  /\ ept_hpa = TRUE
  /\ ept_permissions = TRUE
  /\ ept_valid = TRUE
  /\ ept_id = TRUE
  /\ ept_owner = TRUE
  /\ ept_entries = TRUE
  /\ ept_locked = TRUE
  /\ all_epts = TRUE
  /\ all_vms = TRUE

\* hypervisor_owns_ept (matches Coq: Definition hypervisor_owns_ept)
hypervisor_owns_ept(ept) == TRUE

\* has_vm_creation_capability (matches Coq: Definition has_vm_creation_capability)
has_vm_creation_capability(p) == TRUE

\* gpa_in_ept (matches Coq: Definition gpa_in_ept)
gpa_in_ept(ept, gpa) == TRUE

\* perm_read (matches Coq: Definition perm_read)
perm_read == TRUE

\* perm_write (matches Coq: Definition perm_write)
perm_write == TRUE

\* perm_exec (matches Coq: Definition perm_exec)
perm_exec == TRUE

\* has_permission (matches Coq: Definition has_permission)
has_permission(entry, perm) == TRUE

\* ept_integrity (matches Coq: Theorem ept_integrity)
THEOREM ept_integrity == Init => TypeOK

\* vm_creation_authorized (matches Coq: Theorem vm_creation_authorized)
THEOREM vm_creation_authorized == Init => TypeOK

\* translation_deterministic (matches Coq: Theorem translation_deterministic)
THEOREM translation_deterministic == Init => TypeOK

\* invalid_gpa_no_translation (matches Coq: Theorem invalid_gpa_no_translation)
THEOREM invalid_gpa_no_translation == Init => TypeOK

\* ept_vm_isolation (matches Coq: Theorem ept_vm_isolation)
THEOREM ept_vm_isolation == Init => TypeOK

\* no_cap_no_vm_creation (matches Coq: Theorem no_cap_no_vm_creation)
THEOREM no_cap_no_vm_creation == Init => TypeOK

\* page_table_permission_enforced (matches Coq: Theorem page_table_permission_enforced)
THEOREM page_table_permission_enforced == Init => TypeOK

\* kernel_pages_non_writable_from_user (matches Coq: Theorem kernel_pages_non_writable_from_user)
THEOREM kernel_pages_non_writable_from_user == Init => TypeOK

\* page_fault_handler_safe (matches Coq: Theorem page_fault_handler_safe)
THEOREM page_fault_handler_safe == Init => TypeOK

\* copy_on_write_correct (matches Coq: Theorem copy_on_write_correct)
THEOREM copy_on_write_correct == Init => TypeOK

\* virtual_address_canonical (matches Coq: Theorem virtual_address_canonical)
THEOREM virtual_address_canonical == Init => TypeOK

\* guest_cannot_modify_any_ept (matches Coq: Theorem guest_cannot_modify_any_ept)
THEOREM guest_cannot_modify_any_ept == Init => TypeOK

\* hypervisor_owns_all_epts (matches Coq: Theorem hypervisor_owns_all_epts)
THEOREM hypervisor_owns_all_epts == Init => TypeOK

\* find_ept_deterministic (matches Coq: Theorem find_ept_deterministic)
THEOREM find_ept_deterministic == Init => TypeOK

\* no_ept_no_mapping (matches Coq: Theorem no_ept_no_mapping)
THEOREM no_ept_no_mapping == Init => TypeOK

\* vm_creation_records_creator (matches Coq: Theorem vm_creation_records_creator)
THEOREM vm_creation_records_creator == Init => TypeOK

\* empty_ept_no_translations (matches Coq: Theorem empty_ept_no_translations)
THEOREM empty_ept_no_translations == Init => TypeOK

\* gpa_in_ept_translation_exists (matches Coq: Theorem gpa_in_ept_translation_exists)
THEOREM gpa_in_ept_translation_exists == Init => TypeOK

\* different_vms_different_epts (matches Coq: Theorem different_vms_different_epts)
THEOREM different_vms_different_epts == Init => TypeOK

\* write_protect_enforced (matches Coq: Theorem write_protect_enforced)
THEOREM write_protect_enforced == Init => TypeOK

\* execute_disable_respected (matches Coq: Theorem execute_disable_respected)
THEOREM execute_disable_respected == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<proc_id, proc_vm_create_cap, vm_id, vm_ept_base, vm_memory_size, vm_creator, ept_gpa, ept_hpa, ept_permissions, ept_valid, ept_id, ept_owner, ept_entries, ept_locked, all_epts, all_vms>>

\* Specification
Spec == Init /\ [][Next]_<<proc_id, proc_vm_create_cap, vm_id, vm_ept_base, vm_memory_size, vm_creator, ept_gpa, ept_hpa, ept_permissions, ept_valid, ept_id, ept_owner, ept_entries, ept_locked, all_epts, all_vms>>

====
