---- MODULE ControlFlowIntegrity ----
\* Copyright (c) 2026 The RIINA Authors. All rights reserved.
\* Auto-generated from 02_FORMAL/coq/domains/ControlFlowIntegrity.v (21 invariants)
\* Generated by scripts/generate-full-stack.py

EXTENDS Naturals, FiniteSets, Sequences

\* EdgeType (matches Coq: Inductive EdgeType)
CONSTANTS DirectJump, ConditionalJump, DirectCall, Return, FallThrough

\* MemPerm (matches Coq: Inductive MemPerm)
CONSTANTS Readable, Writable, Executable

\* RelocState (matches Coq: Inductive RelocState)
CONSTANTS PreReloc, PostReloc

\* BasicBlock (matches Coq: Record BasicBlock)
VARIABLES bb_id, bb_start, bb_end, bb_func

\* CFGEdge (matches Coq: Record CFGEdge)
VARIABLES edge_src, edge_dst, edge_type

\* ShadowEntry (matches Coq: Record ShadowEntry)
VARIABLES se_return_addr, se_caller_func

\* FuncType (matches Coq: Record FuncType)
VARIABLES ft_arg_types, Simplified, ft_ret_type

\* TypedFuncPtr (matches Coq: Record TypedFuncPtr)
VARIABLES tfp_addr, tfp_type

\* VTable (matches Coq: Record VTable)
VARIABLES vt_type_id, vt_methods

\* TypedObject (matches Coq: Record TypedObject)
VARIABLES to_vtable, to_expected_type

\* ExceptionHandler (matches Coq: Record ExceptionHandler)
VARIABLES eh_type, eh_addr

\* JmpBuf (matches Coq: Record JmpBuf)
VARIABLES jb_valid, jb_target, jb_stack_ptr

\* ThreadContext (matches Coq: Record ThreadContext)
VARIABLES tc_id, tc_owner, tc_valid

\* Type invariant
TypeOK ==
  /\ bb_id \in BOOLEAN
  /\ bb_start \in BOOLEAN
  /\ bb_end \in BOOLEAN
  /\ bb_func \in BOOLEAN
  /\ edge_src \in BOOLEAN
  /\ edge_dst \in BOOLEAN
  /\ edge_type \in BOOLEAN
  /\ se_return_addr \in BOOLEAN
  /\ se_caller_func \in BOOLEAN
  /\ ft_arg_types \in BOOLEAN
  /\ Simplified \in BOOLEAN
  /\ ft_ret_type \in BOOLEAN
  /\ tfp_addr \in BOOLEAN
  /\ tfp_type \in BOOLEAN
  /\ vt_type_id \in BOOLEAN
  /\ vt_methods \in BOOLEAN
  /\ to_vtable \in BOOLEAN
  /\ to_expected_type \in BOOLEAN
  /\ eh_type \in BOOLEAN
  /\ eh_addr \in BOOLEAN
  /\ jb_valid \in BOOLEAN
  /\ jb_target \in BOOLEAN
  /\ jb_stack_ptr \in BOOLEAN
  /\ tc_id \in BOOLEAN
  /\ tc_owner \in BOOLEAN
  /\ tc_valid \in BOOLEAN

\* Initial state
Init ==
  /\ bb_id = TRUE
  /\ bb_start = TRUE
  /\ bb_end = TRUE
  /\ bb_func = TRUE
  /\ edge_src = TRUE
  /\ edge_dst = TRUE
  /\ edge_type = TRUE
  /\ se_return_addr = TRUE
  /\ se_caller_func = TRUE
  /\ ft_arg_types = TRUE
  /\ Simplified = TRUE
  /\ ft_ret_type = TRUE
  /\ tfp_addr = TRUE
  /\ tfp_type = TRUE
  /\ vt_type_id = TRUE
  /\ vt_methods = TRUE
  /\ to_vtable = TRUE
  /\ to_expected_type = TRUE
  /\ eh_type = TRUE
  /\ eh_addr = TRUE
  /\ jb_valid = TRUE
  /\ jb_target = TRUE
  /\ jb_stack_ptr = TRUE
  /\ tc_id = TRUE
  /\ tc_owner = TRUE
  /\ tc_valid = TRUE

\* edge_in_cfg (matches Coq: Definition edge_in_cfg)
edge_in_cfg(e, cfg) == TRUE

\* shadow_push (matches Coq: Definition shadow_push)
shadow_push(ss, ret, caller) == TRUE

\* valid_return (matches Coq: Definition valid_return)
valid_return(ss, ret_addr) == TRUE

\* valid_indirect_call (matches Coq: Definition valid_indirect_call)
valid_indirect_call(vt, fp) == TRUE

\* has_perm (matches Coq: Definition has_perm)
has_perm(p) == TRUE

\* w_xor_x (matches Coq: Definition w_xor_x)
w_xor_x == TRUE

\* vtable_type_matches (matches Coq: Definition vtable_type_matches)
vtable_type_matches(obj) == TRUE

\* handler_registered (matches Coq: Definition handler_registered)
handler_registered(vhs, h) == TRUE

\* longjmp_safe (matches Coq: Definition longjmp_safe)
longjmp_safe(jb) == TRUE

\* got_writable (matches Coq: Definition got_writable)
got_writable(rs) == TRUE

\* got_protected (matches Coq: Definition got_protected)
got_protected(rs) == TRUE

\* thread_accessible (matches Coq: Definition thread_accessible)
thread_accessible(tc, accessor) == TRUE

\* ctl_001_rop_impossible (matches Coq: Theorem ctl_001_rop_impossible)
THEOREM ctl_001_rop_impossible == Init => TypeOK

\* ctl_002_jop_impossible (matches Coq: Theorem ctl_002_jop_impossible)
THEOREM ctl_002_jop_impossible == Init => TypeOK

\* ctl_003_cop_impossible (matches Coq: Theorem ctl_003_cop_impossible)
THEOREM ctl_003_cop_impossible == Init => TypeOK

\* ctl_004_ret2libc_impossible (matches Coq: Theorem ctl_004_ret2libc_impossible)
THEOREM ctl_004_ret2libc_impossible == Init => TypeOK

\* ctl_005_srop_impossible (matches Coq: Theorem ctl_005_srop_impossible)
THEOREM ctl_005_srop_impossible == Init => TypeOK

\* ctl_006_code_injection_impossible (matches Coq: Theorem ctl_006_code_injection_impossible)
THEOREM ctl_006_code_injection_impossible == Init => TypeOK

\* ctl_007_code_reuse_controlled (matches Coq: Theorem ctl_007_code_reuse_controlled)
THEOREM ctl_007_code_reuse_controlled == Init => TypeOK

\* ctl_008_data_only_mitigated (matches Coq: Theorem ctl_008_data_only_mitigated)
THEOREM ctl_008_data_only_mitigated == Init => TypeOK

\* ctl_009_cf_bending_impossible (matches Coq: Theorem ctl_009_cf_bending_impossible)
THEOREM ctl_009_cf_bending_impossible == Init => TypeOK

\* ctl_010_indirect_call_safe (matches Coq: Theorem ctl_010_indirect_call_safe)
THEOREM ctl_010_indirect_call_safe == Init => TypeOK

\* ctl_011_vtable_hijack_impossible (matches Coq: Theorem ctl_011_vtable_hijack_impossible)
THEOREM ctl_011_vtable_hijack_impossible == Init => TypeOK

\* ctl_012_exception_safe (matches Coq: Theorem ctl_012_exception_safe)
THEOREM ctl_012_exception_safe == Init => TypeOK

\* ctl_013_longjmp_safe (matches Coq: Theorem ctl_013_longjmp_safe)
THEOREM ctl_013_longjmp_safe == Init => TypeOK

\* ctl_014_got_plt_protected (matches Coq: Theorem ctl_014_got_plt_protected)
THEOREM ctl_014_got_plt_protected == Init => TypeOK

\* ctl_015_thread_hijack_impossible (matches Coq: Theorem ctl_015_thread_hijack_impossible)
THEOREM ctl_015_thread_hijack_impossible == Init => TypeOK

\* ctl_016_shadow_push_pop_identity (matches Coq: Theorem ctl_016_shadow_push_pop_identity)
THEOREM ctl_016_shadow_push_pop_identity == Init => TypeOK

\* ctl_017_valid_return_after_push (matches Coq: Theorem ctl_017_valid_return_after_push)
THEOREM ctl_017_valid_return_after_push == Init => TypeOK

\* ctl_018_wxor_x_empty (matches Coq: Theorem ctl_018_wxor_x_empty)
THEOREM ctl_018_wxor_x_empty == Init => TypeOK

\* ctl_019_reloc_state_decidable (matches Coq: Theorem ctl_019_reloc_state_decidable)
THEOREM ctl_019_reloc_state_decidable == Init => TypeOK

\* ctl_020_shadow_push_length (matches Coq: Theorem ctl_020_shadow_push_length)
THEOREM ctl_020_shadow_push_length == Init => TypeOK

\* ctl_021_valid_trace_prefix (matches Coq: Theorem ctl_021_valid_trace_prefix)
THEOREM ctl_021_valid_trace_prefix == Init => TypeOK

\* Next-state relation
Next == UNCHANGED <<bb_id, bb_start, bb_end, bb_func, edge_src, edge_dst, edge_type, se_return_addr, se_caller_func, ft_arg_types, Simplified, ft_ret_type, tfp_addr, tfp_type, vt_type_id, vt_methods, to_vtable, to_expected_type, eh_type, eh_addr, jb_valid, jb_target, jb_stack_ptr, tc_id, tc_owner, tc_valid>>

\* Specification
Spec == Init /\ [][Next]_<<bb_id, bb_start, bb_end, bb_func, edge_src, edge_dst, edge_type, se_return_addr, se_caller_func, ft_arg_types, Simplified, ft_ret_type, tfp_addr, tfp_type, vt_type_id, vt_methods, to_vtable, to_expected_type, eh_type, eh_addr, jb_valid, jb_target, jb_stack_ptr, tc_id, tc_owner, tc_valid>>

====
