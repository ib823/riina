(function(){"use strict";let o=null,a=null;async function i(){if(!o)try{const e=self.location.href.replace(/\/assets\/.*$/,"/"),s=await(await fetch(e+"riina_wasm.wasm")).arrayBuffer(),{instance:t}=await WebAssembly.instantiate(s,{env:{memory:new WebAssembly.Memory({initial:256})}});o=t,a=t.exports.memory,postMessage({type:"ready"})}catch(e){postMessage({type:"error",error:"Failed to load WASM: "+e.message})}}function l(e){const s=new TextEncoder().encode(e),t=o.exports.riina_alloc(s.length);return new Uint8Array(a.buffer).set(s,t),{ptr:t,len:s.length}}function u(e){if(e===0)return'{"ok":false,"error":"null pointer"}';const r=new Uint8Array(a.buffer),s=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,t=r.slice(e+4,e+4+s),c=new TextDecoder().decode(t);return o.exports.riina_free(e,s+4),c}function m(e,r){const{ptr:s,len:t}=l(r),n=o.exports[e](s,t);return o.exports.riina_free(s,t),u(n)}onmessage=async function(e){const{type:r,source:s,id:t}=e.data;if(r==="init"){await i();return}if(!o){postMessage({id:t,type:"result",error:"WASM not loaded"});return}try{let n;switch(r){case"check":n="riina_check";break;case"emitC":n="riina_emit_c";break;case"emitIR":n="riina_emit_ir";break;default:postMessage({id:t,type:"result",error:"Unknown command: "+r});return}const c=m(n,s),d=JSON.parse(c);postMessage({id:t,type:"result",result:d})}catch(n){postMessage({id:t,type:"result",error:n.message})}},i()})();
